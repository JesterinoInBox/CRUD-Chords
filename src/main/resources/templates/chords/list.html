<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Аккорды</title>
    <!-- Bootstrap через WebJars -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.0/css/bootstrap.min.css}">
    <style>
        .chord-img {
            max-height: 150px;
            object-fit: contain;
        }
        .pagination .page-link {
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <h1>Аккорды для гитары</h1>

    <!-- Форма поиска и фильтрации -->
    <div class="card mb-4">
        <div class="card-body">
            <form th:action="@{/chords}" method="get" class="row g-3">
                <div class="col-md-3">
                    <input type="text" name="name" th:value="${name}"
                           class="form-control" placeholder="Поиск по названию...">
                </div>
                <div class="col-md-3">
                    <select name="category" class="form-control">
                        <option value="">Все категории</option>
                        <option th:each="cat : ${categories}"
                                th:value="${cat}"
                                th:text="${cat}"
                                th:selected="${category == cat}">
                        </option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select name="level" class="form-control">
                        <option value="">Все уровни</option>
                        <option th:each="lvl : ${levels}"
                                th:value="${lvl}"
                                th:text="${lvl}"
                                th:selected="${level == lvl}">
                        </option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary">Поиск</button>
                    <a th:href="@{/chords}" class="btn btn-secondary">Сбросить</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Кнопка добавления -->
    <form th:action="@{/chords/new}" method="get" class="mb-3">
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Добавить аккорд
        </button>
    </form>

    <!-- Список аккордов -->
    <div class="row">
        <div th:each="chord : ${chordsPage.content}" class="col-md-4 mb-4">
            <div class="card h-100">
                <!-- Изображение аккорда -->
                <div th:if="${chord.imageUrl}" class="text-center p-3">
                    <img th:src="@{${chord.imageUrl}}"
                         alt="Аккорд"
                         class="img-fluid chord-img">
                </div>
                <div th:unless="${chord.imageUrl}" class="text-center p-3 text-muted">
                    <small>Нет изображения</small>
                </div>

                <div class="card-body">
                    <h5 class="card-title" th:text="${chord.name}">C</h5>
                    <p class="card-text">
                        <span class="badge bg-info" th:text="${chord.category}">Категория</span>
                        <span class="badge bg-warning ms-1" th:text="${chord.level}">Уровень</span>
                    </p>
                    <!-- ASCII диаграмма (если есть) -->
                    <pre th:if="${chord.diagram}"
                         th:text="${chord.diagram}"
                         class="bg-light p-2 small">
                    </pre>
                </div>

                <div class="card-footer">
                    <div class="d-flex gap-1 flex-wrap">
                        <form th:action="@{/chords/{id}(id=${chord.id})}" method="get" class="d-inline">
                            <button type="submit" class="btn btn-outline-info">Просмотр</button>
                        </form>
                        <form th:action="@{/chords/edit/{id}(id=${chord.id})}" method="get" class="d-inline">
                            <button type="submit" class="btn btn-outline-warning">Редактировать</button>
                        </form>
                        <form th:action="@{/chords/delete/{id}(id=${chord.id})}"
                              method="post"
                              class="d-inline"
                              onsubmit="return confirm('Вы уверены, что хотите удалить этот аккорд?');">
                            <button type="submit" class="btn btn-outline-danger">Удалить</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Пагинация -->
    <nav th:if="${chordsPage.totalPages > 1}">
        <ul class="pagination justify-content-center">
            <!-- Первая страница -->
            <li class="page-item" th:classappend="${chordsPage.number == 0} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/chords(name=${name}, category=${category}, level=${level}, page=0)}">
                    Первая
                </a>
            </li>

            <!-- Предыдущая страница -->
            <li class="page-item" th:classappend="${chordsPage.number == 0} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/chords(name=${name}, category=${category}, level=${level}, page=${chordsPage.number-1})}">
                    ←
                </a>
            </li>

            <!-- Номера страниц -->
            <li th:each="pageNum : ${#numbers.sequence(1, chordsPage.totalPages)}"
                class="page-item"
                th:classappend="${pageNum-1 == chordsPage.number} ? 'active'">
                <a class="page-link"
                   th:href="@{/chords(name=${name}, category=${category}, level=${level}, page=${pageNum-1})}"
                   th:text="${pageNum}">
                </a>
            </li>

            <!-- Следующая страница -->
            <li class="page-item"
                th:classappend="${chordsPage.number == chordsPage.totalPages-1} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/chords(name=${name}, category=${category}, level=${level}, page=${chordsPage.number+1})}">
                    →
                </a>
            </li>

            <!-- Последняя страница -->
            <li class="page-item"
                th:classappend="${chordsPage.number == chordsPage.totalPages-1} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/chords(name=${name}, category=${category}, level=${level}, page=${chordsPage.totalPages-1})}">
                    Последняя
                </a>
            </li>
        </ul>

        <!-- Информация о странице -->
        <div class="text-center text-muted mt-2">
            Показано <span th:text="${chordsPage.numberOfElements}">0</span>
            из <span th:text="${chordsPage.totalElements}">0</span> аккордов
            (страница <span th:text="${chordsPage.number + 1}">1</span>
            из <span th:text="${chordsPage.totalPages}">1</span>)
        </div>
    </nav>
</div>

<script th:src="@{/webjars/bootstrap/5.3.0/js/bootstrap.bundle.min.js}"></script>

<script>
    // Авто-сабмит при изменении фильтров (опционально)
    document.querySelectorAll('select[name="category"], select[name="level"]').forEach(select => {
        select.addEventListener('change', function() {
            this.form.submit();
        });
    });
</script>
</body>
</html>
